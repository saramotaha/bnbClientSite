<div class="calendar-container">
  <!-- Calendar Section -->
  <div class="calendar-section">
    <!-- Month Navigation -->
    <div class="month-header">
      <div class="month-selector">
        <span class="month-name">{{ getCurrentMonthName() }} {{ getCurrentYear() }}</span>
        <select [(ngModel)]="selectedMonthIndex" (change)="onMonthYearChange()" class="month-dropdown">
        @for (month of monthOptions; track $index) {
            <option [value]="$index">{{ month }}</option>
        }
        </select>

        <select [(ngModel)]="selectedYear" (change)="onMonthYearChange()" class="year-dropdown">
        @for (year of yearOptions; track year) {
            <option [value]="year">{{ year }} </option>
        }
        </select>
      </div>
    </div>

    <!-- Week Days Header -->
    <div class="week-header">
      @for (day of weekDays; track day) {
        <div class="week-day">{{ day }}</div>
      }
    </div>

    <!-- Calendar Grid with Spinner Overlay -->
    <div class="calendar-grid" [class.loading]="isLoading" (click)="clearSelection()">
      <div *ngIf="isLoading" class="spinner-overlay">
        <div class="spinner"></div>
      </div>

      @for (dateAvailability of calendarDates; track dateAvailability.date.getTime()) {
        <div 
          class="calendar-cell"
          [class.available]="dateAvailability.available && isCurrentMonth(dateAvailability.date) && !isPastDate(dateAvailability.date)"
          [class.unavailable]="!dateAvailability.available || !isCurrentMonth(dateAvailability.date)"
          [class.selected]="isSelected(dateAvailability.date)"
          [class.today]="isToday(dateAvailability.date)"
          [class.other-month]="!isCurrentMonth(dateAvailability.date)"
          [class.blocked]="dateAvailability.blocked"
          [class.past-date]="isPastDate(dateAvailability.date)"
          [class.weekend]="dateAvailability.isWeekend"
          [class.readonly]="readonly"
          (click)="selectDate(dateAvailability); $event.stopPropagation()"
        >
          <div class="date-number">{{ dateAvailability.date.getDate() }}</div>

          @if (dateAvailability.available && isCurrentMonth(dateAvailability.date) && !isPastDate(dateAvailability.date)) {
            <div class="price-container">
              <div class="price">${{ basePrice }}</div>
            </div>
          }

          @if (dateAvailability.blocked) {
            <div class="blocked-indicator" title="Blocked date">ðŸš«</div>
          }

          @if (isCurrentMonth(dateAvailability.date) && !isPastDate(dateAvailability.date) && !readonly) {
            <button 
              class="availability-toggle"
              (click)="toggleDateAvailability(dateAvailability, $event)"
              [title]="dateAvailability.available ? 'Block' : 'Make available'"
            >
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                @if (dateAvailability.available) {
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="9,12 12,15 16,10"></polyline>
                } @else {
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="15" y1="9" x2="9" y2="15"></line>
                  <line x1="9" y1="9" x2="15" y2="15"></line>
                }
              </svg>
            </button>
          }
        </div>
      }
    </div>

    <!-- Calendar Legend -->
    <div class="calendar-legend">
      <div class="legend-item">
        <div class="legend-color available"></div>
        <span>Available</span>
      </div>
      <div class="legend-item">
        <div class="legend-color unavailable"></div>
        <span>Blocked</span>
      </div>
      <div class="legend-item">
        <div class="legend-color today"></div>
        <span>Today</span>
      </div>
      <div class="legend-item">
        <div class="legend-color selected"></div>
        <span>Selected</span>
      </div>
    </div>

    <!-- Month Statistics -->
    <div class="stats-grid stats-grid-two">
      <div class="stat-item">
        <span class="stat-number">{{ getMonthStats().available }}</span>
        <span class="stat-label">Available</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ getMonthStats().blocked }}</span>
        <span class="stat-label">Blocked</span>
      </div>
    </div>
  </div>

  <!-- Settings Sidebar -->
  <div class="settings-sidebar">
    <!-- Price Settings -->
    <div class="settings-section">
      <div class="settings-header">
        <h3 class="settings-title">Price settings</h3>
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </div>
      <div class="setting-item">
        <span class="setting-label">${{ basePrice }} per night</span>
      </div>
      @if (!readonly) {
        <div class="setting-item">
          <input 
            class="price-input" 
            type="number" 
            [(ngModel)]="basePrice"
            (ngModelChange)="onBasePriceChange($event)"
            placeholder="Base price"
            min="0"
            step="1"
          />
          <label>Base price per night</label>
        </div>
      }
    </div>

    <!-- Availability Settings -->
    <div class="settings-section">
      <div class="settings-header">
        <h3 class="settings-title">Availability settings</h3>
        <svg class="chevron-right" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </div>
      <div class="setting-item">
        <span class="setting-label">{{ availabilitySettings.minStay }} â€“ {{ availabilitySettings.maxStay }} night stays</span>
      </div>
      <div class="setting-item">
        <span class="setting-label">{{ availabilitySettings.advanceNotice }}</span>
      </div>
    </div>

    <!-- Bulk Actions -->
    @if (!readonly) {
      <div class="settings-section">
        <div class="settings-header">
          <h3 class="settings-title">Quick actions</h3>
        </div>
        <div class="bulk-actions">
          <button class="bulk-btn" (click)="setAllDatesAvailable(true)">
            Make all available
          </button>
          <button class="bulk-btn" (click)="setAllDatesAvailable(false)">
            Make all unavailable
          </button>
          <button class="bulk-btn" (click)="goToToday()">
            Go to today
          </button>
        </div>
      </div>
    }
  </div>
</div>