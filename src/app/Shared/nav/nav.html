<!-- combined-nav.component.html -->
<div>
  <!-- Base Navigation (always visible) -->
  <header class="py-3">
    <div class="container">
      <div class="row align-items-center">
        <!-- Logo -->
        <div class="col-auto">
          <div class="logo">
            <img class="logo-icon" src="../../../../../../assets/images/Aire de casa design (4).png" alt="logo">
            <span class="logoName">AirDeCasa</span>
          </div>
        </div>
        
        <!-- Search Bar (triggers expanded nav) -->
        <div class="col d-none d-md-block ms-md-5 centerdiv" (click)="toggleMainNav($event)">
          <div class="d-flex align-items-center justify-content-around border rounded-pill py-1 shadow-sm mx-auto" style="max-width: 400px; height: 48px;">
            <div class="d-flex align-items-center">
              <img src="https://a0.muscache.com/im/pictures/airbnb-platform-assets/AirbnbPlatformAssets-search-bar-icons/original/4aae4ed7-5939-4e76-b100-e69440ebeae4.png?im_w=240" style="width: 48px;" alt="">
              <div class="small fw-medium">Anywhere</div>
            </div>
            <div class="border-start px-3 small fw-medium">Any week</div>
            <div class="border-start px-3 small fw-medium">Add guests</div>
            <button class="btn btn-danger btn-sm rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
        
        <!-- Right-side Menu Items -->
        <div class="col-auto">
          <div class="d-flex align-items-center gap-3">
            <a href="#" class="become-host-btn">Become a Host</a>
            
            <!-- Notifications -->
            <app-notifications></app-notifications>
            
            <!-- profile -->
             <div class="profile-icon-container">
                <div class="profile-icon" (click)="toggleUserMenu($event)">
                {{ getUserInitials() }}
                </div>
              </div>
            <!-- User Menu -->
            <div class="user-menu bg-body-secondary d-flex align-items-center justify-content-center border rounded-circle" 
                style="width: 40px; height: 40px; position: relative;">
              <button class="btn-icon d-flex justify-content-center align-items-center text-center" 
                      (click)="toggleUserMenu($event)">
                <i class="bi bi-list fs-5 text-center"></i>
              </button>
              <div class="user-dropdown" *ngIf="showUserMenu">
                <div class="dropdown-item" *ngFor="let item of userMenuItems" >
                  <label (click)="navigateTo(item.route || '')" *ngIf="item.name !== 'Logout'" style="display: flex; align-items: center; cursor: pointer; padding: 5px 10px;">
                    <i class="bi {{item.icon}}" style="margin-right: 10px;"></i>
                    {{item.name}}
                  </label>
                  <label (click)="handleLogout()" *ngIf="item.name === 'Logout'" style="display: flex; align-items: center; cursor: pointer; padding: 5px 10px;">
                    <i class="bi {{item.icon}}" style="margin-right: 10px;"></i>
                    {{item.name}}
                  </label>
                </div>
              </div>
            </div>
          </div>
      </div>
      </div>
    </div>
  </header>

  <!-- Expanded Search Navigation (shown when clicking search bar) -->
  <nav class="airbnb-navbar" 
     *ngIf="showMainNav || isClosingMainNav" 
     [class.slide-up]="isClosingMainNav">
    <div class="search-container mb-5">
      <div class="search-bar">
        <div class="search-input-group">
          <!-- Where Field -->
          <div class="search-field where-field">
            <label>Where</label>
            <input type="text" placeholder="Search destinations" [(ngModel)]="searchQuery" class="search-input">
          </div>

          <div class="divider"></div>

          <!-- Check-in Field -->
          <div class="search-field checkin-field" (mouseenter)="onCheckInHover()" [class.active]="showCheckInCalendar">
            <label>Check in</label>
            <input type="text" placeholder="Add dates" [value]="formatDate(checkInDate)" readonly class="search-input">
          </div>

          <div class="divider"></div>

          <!-- Check-out Field -->
          <div class="search-field checkout-field" (mouseenter)="onCheckOutHover()" [class.active]="showCheckOutCalendar">
            <label>Check out</label>
            <input type="text" placeholder="Add dates" [value]="formatDate(checkOutDate)" readonly class="search-input">
          </div>

          <div class="divider"></div>

          <!-- Guests Field -->
          <div class="search-field who-field" (click)="onGuestsClick()" [class.active]="showGuestsDropdown">
            <label>Who</label>
            <input type="text" placeholder="Add guests"
              [value]="getTotalGuests() > 0 ? getTotalGuests() + ' guest' + (getTotalGuests() > 1 ? 's' : '') : ''" readonly
              class="search-input">
          </div>

          <!-- Search Button -->
          <button class="search-button" (click)="onSearch()">
            <svg viewBox="0 0 32 32"
              style="display:block;fill:none;height:16px;width:16px;stroke:currentColor;stroke-width:4;overflow:visible">
              <path fill="none"
                d="m13 24c6.0751322 0 11-4.9248678 11-11s-4.9248678-11-11-11-11 4.9248678-11 11 4.9248678 11 11 11zm8-3 10 10">
              </path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Check-in Calendar Dropdown -->
      <div class="calendar-dropdown" *ngIf="showCheckInCalendar">
        <div class="calendar-header">
          <button (click)="previousMonth()" class="nav-button">&lt;</button>
          <h3>{{ getMonthYear() }}</h3>
          <button (click)="nextMonth()" class="nav-button">&gt;</button>
        </div>
        <div class="calendar-grid">
          <div class="day-header">Sun</div>
          <div class="day-header">Mon</div>
          <div class="day-header">Tue</div>
          <div class="day-header">Wed</div>
          <div class="day-header">Thu</div>
          <div class="day-header">Fri</div>
          <div class="day-header">Sat</div>

          <div *ngFor="let day of checkInCalendarDays" class="calendar-day" 
               [class.other-month]="!day.isCurrentMonth"
               [class.today]="day.isToday"
               [class.selected]="checkInDate && day.date.toDateString() === checkInDate.toDateString()"
               [class.past]="day.isPast" 
               (click)="selectCheckInDate(day)">
            {{ day.day }}
          </div>
        </div>
      </div>

      <!-- Check-out Calendar Dropdown -->
      <div class="calendar-dropdown" *ngIf="showCheckOutCalendar">
        <div class="calendar-header">
          <button (click)="previousMonth()" class="nav-button">&lt;</button>
          <h3>{{ getMonthYear() }}</h3>
          <button (click)="nextMonth()" class="nav-button">&gt;</button>
        </div>
        <div class="calendar-grid">
          <div class="day-header">Sun</div>
          <div class="day-header">Mon</div>
          <div class="day-header">Tue</div>
          <div class="day-header">Wed</div>
          <div class="day-header">Thu</div>
          <div class="day-header">Fri</div>
          <div class="day-header">Sat</div>

          <div *ngFor="let day of checkOutCalendarDays" class="calendar-day" 
               [class.other-month]="!day.isCurrentMonth"
               [class.today]="day.isToday"
               [class.selected]="checkOutDate && day.date.toDateString() === checkOutDate.toDateString()"
               [class.past]="day.isPast" 
               (click)="selectCheckOutDate(day)">
            {{ day.day }}
          </div>
        </div>
      </div>

      <!-- Guests Dropdown -->
      <div class="guests-dropdown" *ngIf="showGuestsDropdown">
        <div class="guest-type">
          <div class="guest-info">
            <div class="guest-title">Adults</div>
            <div class="guest-subtitle">Ages 13 or above</div>
          </div>
          <div class="guest-controls">
            <button (click)="adjustGuests('adults', 'decrement')" [disabled]="guests.adults <= 1" class="guest-button">-</button>
            <span class="guest-count">{{ guests.adults }}</span>
            <button (click)="adjustGuests('adults', 'increment')" class="guest-button">+</button>
          </div>
        </div>

        <div class="guest-type">
          <div class="guest-info">
            <div class="guest-title">Children</div>
            <div class="guest-subtitle">Ages 2â€“12</div>
          </div>
          <div class="guest-controls">
            <button (click)="adjustGuests('children', 'decrement')" [disabled]="guests.children <= 0" class="guest-button">-</button>
            <span class="guest-count">{{ guests.children }}</span>
            <button (click)="adjustGuests('children', 'increment')" class="guest-button">+</button>
          </div>
        </div>

        <div class="guest-type">
          <div class="guest-info">
            <div class="guest-title">Infants</div>
            <div class="guest-subtitle">Under 2</div>
          </div>
          <div class="guest-controls">
            <button (click)="adjustGuests('infants', 'decrement')" [disabled]="guests.infants <= 0" class="guest-button">-</button>
            <span class="guest-count">{{ guests.infants }}</span>
            <button (click)="adjustGuests('infants', 'increment')" class="guest-button">+</button>
          </div>
        </div>
      </div>
    </div>
  </nav>
</div>